version: 1
service: router
username: router
scripts:
  build_inside_vm: /home/$USERNAME/router/setup_router_and_proxy.sh
  start_once: /home/$USERNAME/router/deploy_local_proxies.sh > /home/$USERNAME/router/deploy_local_proxies.log 2>&1
files:
  - sources:
      - requirements.txt
      - deploy_proxies.py
      - config.py
      - settings.py
      - local_connection.py
      - router
      - nginx
      - iptables
      - monitoring
    destination: /home/$USERNAME

  # Note! Following paths are absolute and runner-specific
  - source: /etc/letsencrypt/archive/
    destination: /home/$USERNAME/certificates/
  - source: /home/runner/do_api_token
    destination: /home/$USERNAME

  # Service configs
  - source: ../passmgr/deploy.yaml
    destination: /home/$USERNAME/configs/passmgr/
  # - source: ../spaces/deploy.yaml
  #   destination: /home/$USERNAME/configs/spaces/
  # - source: ../lockstone/deploy.yaml
  #   destination: /home/$USERNAME/configs/lockstone/
  # - source: ../godeeper/deploy.yaml
  #   destination: /home/$USERNAME/configs/godeeper/
  # - source: ../pure/deploy.yaml
  #   destination: /home/$USERNAME/configs/pure/
  - source: ../funding/deploy.yaml
    destination: /home/$USERNAME/configs/funding/
  # - source: ../keys/deploy.yaml
  #   destination: /home/$USERNAME/configs/keys/
  # - source: ../places/deploy.yaml
  #   destination: /home/$USERNAME/configs/places/
  - source: ../docs/deploy.yaml
    destination: /home/$USERNAME/configs/docs/
  # - source: ../tokenourcer/deploy.yaml
  #   destination: /home/$USERNAME/configs/tokenourcer/
  - source: ../notes/deploy.yaml
    destination: /home/$USERNAME/configs/notes/

  - source: router/motd
    destination: /etc/
